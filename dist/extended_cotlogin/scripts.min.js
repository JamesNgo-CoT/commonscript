"use strict";var _createClass=function(){function e(o,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}return function(o,t,n){return t&&e(o.prototype,t),n&&e(o,n),o}}(),_get=function o(t,n,e){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:o(r,n,e)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(e):void 0};function _classCallCheck(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?o:t}function _inherits(o,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var ExtendedCotSession=function(o){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,CotSession),_createClass(t,[{key:"isLoggedIn",value:function(i){var r=this;if(!i)return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"isLoggedIn",this).call(this,i);var s=this.sid||this._cookie("sid");if(s){var o=""+this.options.ccApiOrigin+this.options.ccApiPath+this.options.ccApiEndpoint;o=-1!==o.indexOf("/c3api_auth/v2/AuthService.svc/AuthSet")?o+"('"+s+"')":o+"/"+s,$.get(o).done(function(o){var t=o.app||"",n=o.sid||"",e=o.error||"";t===r.options.appName&&n===s?(r._storeLogin(o),i(CotSession.LOGIN_CHECK_RESULT_TRUE)):"no_such_session"===e?(r.logout(),i(CotSession.LOGIN_CHECK_RESULT_FALSE)):i(CotSession.LOGIN_CHECK_RESULT_INDETERMINATE)}).fail(function(){i(CotSession.LOGIN_CHECK_RESULT_INDETERMINATE)})}else i(CotSession.LOGIN_CHECK_RESULT_FALSE)}},{key:"login",value:function(e){var t=this;e=$.extend({username:"",password:"",success:function(){},error:function(){},always:function(){}},e);var o={app:this.options.appName,user:e.username,pwd:e.password},n={method:"POST",url:""+this.options.ccApiOrigin+this.options.ccApiPath+this.options.ccApiEndpoint};-1!==n.url.indexOf("/c3api_auth/v2/AuthService.svc/AuthSet")?(n.contentType="application/json",n.data=JSON.stringify(o)):n.data=o,$.ajax(n).done(function(o){o.error?e.error(null,"invalid_user_or_pwd"===o.error?"Invalid username or password":"Login failed",o.error):o.passwordIsExpired?e.error(null,"Expired password","passwordIsExpired"):(t._storeLogin(o),e.success())}).fail(function(o,t,n){e.error(o,t,n)}).always(function(){e.always()})}}]),t}(),ExtendedCotLogin=function(o){function n(o){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o));return t.session=new ExtendedCotSession({appName:t.options.appName,ccApiOrigin:t.options.ccRoot||void 0,ccApiPath:t.options.ccPath||void 0,ccApiEndpoint:t.options.ccEndpoint||void 0}),t._setUserName(),t}return _inherits(n,cot_login),_createClass(n,[{key:"checkLogin",value:function(){var o=this;return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).serverSide?new Promise(function(t,n){o.isLoggedIn(function(o){o===CotSession.LOGIN_CHECK_RESULT_TRUE?t():n()})}):this.isLoggedIn()?Promise.resolve():Promise.reject()}},{key:"isLoggedIn",value:function(o){return this.session.isLoggedIn(o)}},{key:"requireLogin",value:function(n){var e=this;return Promise.resolve().then(function(){return e.checkLogin(n)}).catch(function(){return new Promise(function(o,t){e.showLogin($.extend({onHidden:function(){e.checkLogin(n).then(function(){o()},function(){t()})}},n))})}).catch(function(){return e.logout(),Promise.reject()})}},{key:"showLogin",value:function(o){var t=this;this.modal=cot_app.showModal($.extend({body:'\n        <form>\n          <div class="form-group">\n            <label for="cot_login_username">Username</label>:\n            <input class="form-control" id="cot_login_username">\n          </div>\n          <div class="form-group">\n            <label for="cot_login_password">Password</label>:\n            <input class="form-control" type="password" id="cot_login_password">\n          </div>\n        </form>\n      ',className:"cot-login-modal",footerButtonsHtml:'\n\t\t  <button class="btn btn-primary btn-cot-login" type="button">Login</button>\n\t\t  <button class="btn btn-default" type="button" data-dismiss="modal">Cancel</button>\n      ',onShown:function(){t.modal.find(".btn-cot-login").click(function(){t._login()}),t.modal.find(".modal-body input").keydown(function(o){13===(o.charCode||o.keyCode||0)&&t._login()})},originatingElement:$(this.options.welcomeSelector).find("a.login"),title:"User Login"},o))}}]),n}();
//# sourceMappingURL=scripts.min.js.map
