"use strict";var _createClass=function(){function e(t,o){for(var n=0;n<o.length;n++){var e=o[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),_get=function t(o,n,e){null===o&&(o=Function.prototype);var i=Object.getOwnPropertyDescriptor(o,n);if(void 0===i){var r=Object.getPrototypeOf(o);return null===r?void 0:t(r,n,e)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(e):void 0};function _classCallCheck(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,o){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?t:o}function _inherits(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);t.prototype=Object.create(o&&o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(t,o):t.__proto__=o)}var ExtendedCotSession=function(t){function o(){return _classCallCheck(this,o),_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return _inherits(o,CotSession),_createClass(o,[{key:"isLoggedIn",value:function(i){var r=this;if("function"!=typeof i)return _get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"isLoggedIn",this).call(this);var s=this.sid||this._cookie("sid");if(s){var t=""+this.options.ccApiOrigin+this.options.ccApiPath+this.options.ccApiEndpoint;t=-1!==t.indexOf("/c3api_auth/v2/AuthService.svc/AuthSet")?t+"('"+s+"')":t+"/"+s,$.get(t).done(function(t){var o=t.app||"",n=t.sid||"",e=t.error||"";o===r.options.appName&&n===s?(r._storeLogin(t),i(CotSession.LOGIN_CHECK_RESULT_TRUE)):"no_such_session"===e?(r.logout(),i(CotSession.LOGIN_CHECK_RESULT_FALSE)):i(CotSession.LOGIN_CHECK_RESULT_INDETERMINATE)}).fail(function(){i(CotSession.LOGIN_CHECK_RESULT_INDETERMINATE)})}else i(CotSession.LOGIN_CHECK_RESULT_FALSE)}},{key:"login",value:function(e){var o=this;e=$.extend({username:"",password:"",success:function(){},error:function(){},always:function(){}},e);var t={app:this.options.appName,user:e.username,pwd:e.password},n={method:"POST",url:""+this.options.ccApiOrigin+this.options.ccApiPath+this.options.ccApiEndpoint};-1!==n.url.indexOf("/c3api_auth/v2/AuthService.svc/AuthSet")?(n.contentType="application/json",n.data=JSON.stringify(t)):n.data=t,$.ajax(n).done(function(t){t.error?e.error(null,"invalid_user_or_pwd"===t.error?"Invalid username or password":"Login failed",t.error):t.passwordIsExpired?e.error(null,"Expired password","passwordIsExpired"):(o._storeLogin(t),e.success())}).fail(function(t,o,n){e.error(t,o,n)}).always(function(){e.always()})}}]),o}();function PrototypeCopyCotLogin(){}PrototypeCopyCotLogin.prototype=cot_login.prototype;var ExtendedCotLogin=function(t){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var o=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(o.options=$.extend({appName:"",ccRoot:"",ccPath:"",ccEndpoint:"",welcomeSelector:"",loginMessage:"",onLogin:function(){}},t),!o.options.appName)throw new Error("Error: the appName option is required");return o.session=new ExtendedCotSession({appName:o.options.appName,ccApiOrigin:o.options.ccRoot||void 0,ccApiPath:o.options.ccPath||void 0,ccApiEndpoint:o.options.ccEndpoint||void 0}),o._setUserName(),o}return _inherits(n,PrototypeCopyCotLogin),_createClass(n,[{key:"checkLogin",value:function(){var t=this;return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).serverSide?new Promise(function(o){t.isLoggedIn(function(t){t===CotSession.LOGIN_CHECK_RESULT_TRUE?o(!0):o(!1)})}):this.isLoggedIn()?Promise.resolve(!0):Promise.resolve(!1)}},{key:"isLoggedIn",value:function(t){return this.session.isLoggedIn(t)}},{key:"requireLogin",value:function(n){var e=this;return this.checkLogin(n).then(function(t){if(!1===t)return new Promise(function(t,o){e.showLogin($.extend({onHidden:function(){e.checkLogin(n).then(function(){t()},function(){e.logout(),o()})}},n))})})}},{key:"showLogin",value:function(t){var o=this;this.modal=cot_app.showModal($.extend({body:'\n\t\t\t\t<form>\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<label for="cot_login_username">Username</label>:\n\t\t\t\t\t\t<input class="form-control" id="cot_login_username">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<label for="cot_login_password">Password</label>:\n\t\t\t\t\t\t<input class="form-control" type="password" id="cot_login_password">\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t',className:"cot-login-modal",footerButtonsHtml:'\n\t\t\t\t<button class="btn btn-primary btn-cot-login" type="button">Login</button>\n\t\t\t\t<button class="btn btn-default" type="button" data-dismiss="modal">Cancel</button>\n\t\t\t',originatingElement:$(this.options.welcomeSelector).find("a.login"),title:"User Login",onShown:function(){o.modal.find(".btn-cot-login").click(function(){o._login()}),o.modal.find(".modal-body input").keydown(function(t){13===(t.charCode||t.keyCode||0)&&o._login()})}},t))}}]),n}();
//# sourceMappingURL=extended_cotlogin.min.js.map
