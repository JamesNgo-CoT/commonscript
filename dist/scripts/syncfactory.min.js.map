{"version":3,"sources":["scripts/syncfactory.min.js"],"names":["syncFactory","sync","cotLogin","_this","this","newSync","method","model","options","arguments","length","undefined","attempt","deferred","$","Deferred","Promise","resolve","then","_","result","requireLogin","originatingElement","$originatingElement","reject","jqXHR","setRequestHeader","sid","call","textStatus","errorThrown","status","responseJSON","responseText","indexOf","showLogin","onHidden","checkLogin","logout","error","message"],"mappings":"AAAA,aAGA,SAASA,YAAYC,EAAMC,GAC1B,IAAIC,EAAQC,KA+DZ,OA7Dc,SAASC,EAAQC,EAAQC,GACtC,IAAIC,EAA6B,EAAnBC,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAC9EG,EAA6B,EAAnBH,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,EAE9EI,EAAWC,EAAEC,WAsDjB,OApDAC,QAAQC,UAAUC,KAAK,WACtB,GAAIC,EAAEC,OAAOb,EAAO,kBACnB,OAAIL,EACIA,EAASmB,aAAa,CAC5BC,mBAAoBd,EAAQe,sBAGtBP,QAAQQ,WAGfN,KAAK,WACHC,EAAEC,OAAOb,EAAO,oBACnBC,EAAoB,WAAI,SAAUiB,GACjCA,EAAMC,iBAAiB,gBAAiB,eAAiBxB,EAASyB,OAIpEnB,EAAqB,YAAIA,EAAqB,aAAK,mBAEnDP,EAAK2B,KAAKzB,EAAOG,EAAQC,EAAOC,GAASU,KAAKL,EAASI,QAAS,SAAUQ,EAAOI,EAAYC,GACxE,KAAhBL,EAAMM,QAAiBN,EAAMM,QAAU,IAC1CD,EAAc,wDACa,MAAjBL,EAAMM,SAAmBN,EAAMO,cAAgBP,EAAMQ,eAA8D,IAA9CR,EAAMQ,aAAaC,QAAQ,gBAAsE,IAA9CT,EAAMQ,aAAaC,QAAQ,cAE7I,IAAZtB,EACHV,EAASiC,UAAU,CAClBC,SAAU,WACTlC,EAASmC,WAAW7B,GAASU,KAAK,WACjCb,EAAQuB,KAAKzB,EAAOG,EAAQC,EAAOC,EAASI,EAAU,IACpD,WACEV,EAASyB,KACZzB,EAASoC,YAIZhB,mBAAoBd,EAAQe,sBAG7BO,EAAc,iBAELL,EAAMO,cAAgBP,EAAMO,aAAaO,OAASd,EAAMO,aAAaO,MAAMC,QACrFV,EAAcL,EAAMO,aAAaO,MAAMC,QAC7Bf,EAAMQ,eAChBH,EAAcL,EAAMQ,cAGrBpB,EAASW,OAAOC,EAAOI,EAAYC,MAElC,WACFjB,EAASW,OAAO,KAAM,KAAM,oBAGtBX","file":"syncfactory.min.js","sourcesContent":["'use strict';\n\n/* exported syncFactory */\nfunction syncFactory(sync, cotLogin) {\n\tvar _this = this;\n\n\tvar newSync = function newSync(method, model) {\n\t\tvar options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\t\tvar attempt = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;\n\n\t\tvar deferred = $.Deferred();\n\n\t\tPromise.resolve().then(function () {\n\t\t\tif (_.result(model, 'syncNeedsLogin')) {\n\t\t\t\tif (cotLogin) {\n\t\t\t\t\treturn cotLogin.requireLogin({\n\t\t\t\t\t\toriginatingElement: options.$originatingElement\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn Promise.reject();\n\t\t\t\t}\n\t\t\t}\n\t\t}).then(function () {\n\t\t\tif (_.result(model, 'syncNeedsLogin')) {\n\t\t\t\toptions['beforeSend'] = function (jqXHR) {\n\t\t\t\t\tjqXHR.setRequestHeader('Authorization', 'AuthSession ' + cotLogin.sid);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toptions['contentType'] = options['contentType'] || 'application/json';\n\n\t\t\tsync.call(_this, method, model, options).then(deferred.resolve, function (jqXHR, textStatus, errorThrown) {\n\t\t\t\tif (jqXHR.status >= 500 && jqXHR.status <= 599) {\n\t\t\t\t\terrorThrown = 'Server side error. Please contact your administrator.';\n\t\t\t\t} else if (jqXHR.status === 400 && !jqXHR.responseJSON && jqXHR.responseText && jqXHR.responseText.indexOf('Session id') !== -1 && jqXHR.responseText.indexOf('is invalid') !== -1) {\n\n\t\t\t\t\tif (attempt === 1) {\n\t\t\t\t\t\tcotLogin.showLogin({\n\t\t\t\t\t\t\tonHidden: function onHidden() {\n\t\t\t\t\t\t\t\tcotLogin.checkLogin(options).then(function () {\n\t\t\t\t\t\t\t\t\tnewSync.call(_this, method, model, options, attempt + 1);\n\t\t\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t\t\tif (cotLogin.sid) {\n\t\t\t\t\t\t\t\t\t\tcotLogin.logout();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toriginatingElement: options.$originatingElement\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\terrorThrown = 'Login Required';\n\t\t\t\t\t}\n\t\t\t\t} else if (jqXHR.responseJSON && jqXHR.responseJSON.error && jqXHR.responseJSON.error.message) {\n\t\t\t\t\terrorThrown = jqXHR.responseJSON.error.message;\n\t\t\t\t} else if (jqXHR.responseText) {\n\t\t\t\t\terrorThrown = jqXHR.responseText;\n\t\t\t\t}\n\n\t\t\t\tdeferred.reject(jqXHR, textStatus, errorThrown);\n\t\t\t});\n\t\t}, function () {\n\t\t\tdeferred.reject(null, null, 'Login Required');\n\t\t});\n\n\t\treturn deferred;\n\t};\n\n\treturn newSync;\n}"]}