{"version":3,"sources":["scripts/sync.min.js"],"names":["Backbone","sync","syncCounter","method","model","_this","this","options","arguments","length","undefined","deferred","$","Deferred","Promise","resolve","then","syncNeedsLogin","cotLogin","requireLogin","originatingElement","reject","jqXHR","setRequestHeader","sid","trigger","call","data","textStatus","errorThrown","status","responseJSON","responseText","indexOf","showLogin","onHidden","checkLogin","logout","error","message","always"],"mappings":"AAAA,aAEAA,SAASC,KAAO,SAAUA,GACzB,IAAIC,EAAc,EAElB,OAAO,SAAUC,EAAQC,GACxB,IAAIC,EAAQC,KAERC,EAA6B,EAAnBC,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAE9EG,EAAWC,EAAEC,WAqEjB,OAnEAC,QAAQC,UAAUC,KAAK,WACtB,IAA6B,IAAzBZ,EAAMa,eACT,OAA8B,MAA1BjB,SAASC,KAAKiB,SACVlB,SAASC,KAAKiB,SAASC,aAAa,CAC1CC,mBAAoBb,EAA6B,sBAG3CO,QAAQO,WAGfL,KAAK,YACsB,IAAzBZ,EAAMa,iBACTV,EAAoB,WAAI,SAAUe,GACjCA,EAAMC,iBAAiB,gBAAiB,eAAiBvB,SAASC,KAAKiB,SAASM,OAIlFjB,EAAqB,YAAIA,EAAqB,aAAK,mBAEnDL,GAA4B,EAC5BF,SAASyB,QAAQ,OAAQ,KAAMvB,GAC/BF,SAASyB,QAAQ,UAAWvB,GAE5BD,EAAKyB,KAAKrB,EAAOF,EAAQC,EAAOG,GAASS,KAAK,SAAUW,EAAMC,EAAYN,GACzEX,EAASI,QAAQY,EAAMC,EAAYN,IACjC,SAAUA,EAAOM,EAAYC,GACX,KAAhBP,EAAMQ,QAAiBR,EAAMQ,QAAU,IAC1CnB,EAASU,OAAOC,EAAOM,EAAY,yDACR,MAAjBN,EAAMQ,SAAmBR,EAAMS,cAAgBT,EAAMU,eAA8D,IAA9CV,EAAMU,aAAaC,QAAQ,gBAAsE,IAA9CX,EAAMU,aAAaC,QAAQ,eAEhI,IAAzB7B,EAAMa,gBAAqD,MAA1BjB,SAASC,KAAKiB,WAAiD,IAA7BX,EAAuB,cAC7FP,SAASC,KAAKiB,SAASgB,UAAU,CAChCC,SAAU,WACTnC,SAASC,KAAKiB,SAASkB,WAAW7B,GAASS,KAAK,WAC/CT,EAAuB,eAAI,EAC3BP,SAASC,KAAKE,EAAQC,EAAOG,GAASS,KAAK,SAAUW,EAAMC,EAAYN,GACtEX,EAASI,QAAQY,EAAMC,EAAYN,IACjC,SAAUA,EAAOM,EAAYC,GAC/BlB,EAASU,OAAOC,EAAOM,EAAYC,MAElC,WACgC,MAA9B7B,SAASC,KAAKiB,SAASM,KAC1BxB,SAASC,KAAKiB,SAASmB,YAI1BjB,mBAAoBb,EAA6B,sBAGlDI,EAASU,OAAOC,EAAOM,EAAY,mBAE1BN,EAAMS,cAAgBT,EAAMS,aAAaO,OAAShB,EAAMS,aAAaO,MAAMC,QACrF5B,EAASU,OAAOC,EAAOM,EAAYN,EAAMS,aAAaO,MAAMC,SAClDjB,EAAMU,aAChBrB,EAASU,OAAOC,EAAOM,EAAYN,EAAMU,cAEzCrB,EAASU,OAAOC,EAAOM,EAAYC,KAElCW,OAAO,WACTtC,EAA4B,EAAdA,EAAkBA,EAAc,EAAI,EAClDF,SAASyB,QAAQ,OAAQ,MAAOvB,GAChCF,SAASyB,QAAQ,WAAYvB,MAE5B,WACFS,EAASU,OAAO,KAAM,KAAM,oBAGtBV,GA7EO,CA+EdX,SAASC,MAEXD,SAASC,KAAKiB,SAAW","file":"sync.min.js","sourcesContent":["'use strict';\n\nBackbone.sync = function (sync) {\n\tvar syncCounter = 0;\n\n\treturn function (method, model) {\n\t\tvar _this = this;\n\n\t\tvar options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n\t\tvar deferred = $.Deferred();\n\n\t\tPromise.resolve().then(function () {\n\t\t\tif (model.syncNeedsLogin === true) {\n\t\t\t\tif (Backbone.sync.cotLogin != null) {\n\t\t\t\t\treturn Backbone.sync.cotLogin.requireLogin({\n\t\t\t\t\t\toriginatingElement: options['$originatingElement']\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn Promise.reject();\n\t\t\t\t}\n\t\t\t}\n\t\t}).then(function () {\n\t\t\tif (model.syncNeedsLogin === true) {\n\t\t\t\toptions['beforeSend'] = function (jqXHR) {\n\t\t\t\t\tjqXHR.setRequestHeader('Authorization', 'AuthSession ' + Backbone.sync.cotLogin.sid);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toptions['contentType'] = options['contentType'] || 'application/json';\n\n\t\t\tsyncCounter = syncCounter + 1;\n\t\t\tBackbone.trigger('sync', 'on', syncCounter);\n\t\t\tBackbone.trigger('sync:on', syncCounter);\n\n\t\t\tsync.call(_this, method, model, options).then(function (data, textStatus, jqXHR) {\n\t\t\t\tdeferred.resolve(data, textStatus, jqXHR);\n\t\t\t}, function (jqXHR, textStatus, errorThrown) {\n\t\t\t\tif (jqXHR.status >= 500 && jqXHR.status <= 599) {\n\t\t\t\t\tdeferred.reject(jqXHR, textStatus, 'Server side error. Please contact your administrator.');\n\t\t\t\t} else if (jqXHR.status === 400 && !jqXHR.responseJSON && jqXHR.responseText && jqXHR.responseText.indexOf('Session id') !== -1 && jqXHR.responseText.indexOf('is invalid') !== -1) {\n\n\t\t\t\t\tif (model.syncNeedsLogin === true && Backbone.sync.cotLogin != null && options['secondAttempt'] !== true) {\n\t\t\t\t\t\tBackbone.sync.cotLogin.showLogin({\n\t\t\t\t\t\t\tonHidden: function onHidden() {\n\t\t\t\t\t\t\t\tBackbone.sync.cotLogin.checkLogin(options).then(function () {\n\t\t\t\t\t\t\t\t\toptions['secondAttempt'] = true;\n\t\t\t\t\t\t\t\t\tBackbone.sync(method, model, options).then(function (data, textStatus, jqXHR) {\n\t\t\t\t\t\t\t\t\t\tdeferred.resolve(data, textStatus, jqXHR);\n\t\t\t\t\t\t\t\t\t}, function (jqXHR, textStatus, errorThrown) {\n\t\t\t\t\t\t\t\t\t\tdeferred.reject(jqXHR, textStatus, errorThrown);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t\t\tif (Backbone.sync.cotLogin.sid != null) {\n\t\t\t\t\t\t\t\t\t\tBackbone.sync.cotLogin.logout();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toriginatingElement: options['$originatingElement']\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.reject(jqXHR, textStatus, 'Login Required.');\n\t\t\t\t\t}\n\t\t\t\t} else if (jqXHR.responseJSON && jqXHR.responseJSON.error && jqXHR.responseJSON.error.message) {\n\t\t\t\t\tdeferred.reject(jqXHR, textStatus, jqXHR.responseJSON.error.message);\n\t\t\t\t} else if (jqXHR.responseText) {\n\t\t\t\t\tdeferred.reject(jqXHR, textStatus, jqXHR.responseText);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.reject(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}).always(function () {\n\t\t\t\tsyncCounter = syncCounter > 0 ? syncCounter - 1 : 0;\n\t\t\t\tBackbone.trigger('sync', 'off', syncCounter);\n\t\t\t\tBackbone.trigger('sync:off', syncCounter);\n\t\t\t});\n\t\t}, function () {\n\t\t\tdeferred.reject(null, null, 'Login Required');\n\t\t});\n\n\t\treturn deferred;\n\t};\n}(Backbone.sync);\n\nBackbone.sync.cotLogin = null;"]}