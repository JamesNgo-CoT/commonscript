"use strict";var DataTableView=Backbone.View.extend({className:"DataTableView",configuration:{columns:function(){return[DataTableView.columns.id]}},dataTable:null,template:function(n){return'\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-xs-12">\n\t\t\t\t\t<table width="100%" class="table table-bordered">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t'+function(){for(var t=[],e=0,a=n.configuration.columns.length;e<a;e++)t.push("\n\t\t\t\t\t<th>\n\t\t\t\t\t\t"+(_.result(n.configuration.columns[e],"title")||_.result(n.configuration.columns[e],"data",""))+"\n\t\t\t\t\t</th>\n\t\t\t\t");return t.join("")}()+"\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t"+function(){var t=[];if(!1!==n.configuration.showHeaderHtml){t.push("<tr>");for(var e=0,a=n.configuration.columns.length;e<a;e++)t.push('\n\t\t\t\t\t\t<th data-index="'+e+'" class="'+_.result(n.configuration.columns[e],"className","")+'">\n\t\t\t\t\t\t\t'+_.result($.extend({view:n.view},n.configuration.columns[e]),"headerHtml","")+"\n\t\t\t\t\t\t</th>\n\t\t\t\t\t");t.push("</tr>")}return t.join("")}()+"\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody></tbody>\n\t\t\t\t\t\t"+function(){var t=[];if(!1!==n.configuration.showFooterHtml){t.push("<tr>");for(var e=0,a=n.configuration.columns.length;e<a;e++)t.push('\n\t\t\t\t\t\t<th data-index="'+e+'" class="'+_.result(n.configuration.columns[e],"className","")+'">\n\t\t\t\t\t\t\t'+_.result($.extend({view:n.view},n.configuration.columns[e]),"footerHtml","")+"\n\t\t\t\t\t\t</th>\n\t\t\t\t\t");t.push("</tr>")}return t.join("")}()+"\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"},resetFilters:function(){$('tfoot input[type="text"], thead input[type="text"]',this.$el).each(function(t,e){$(e).val($(e).attr("value")||"").change()}),$("tfoot select, thead select",this.$el).each(function(t,e){var a=$(e).find("[selected]"),n=a.attr("value");$(e).val(null!=n?n:a.text()).change()}),this.dataTable.search("").draw()},reload:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.dataTable&&this.dataTable.ajax.reload(t,e)},remove:function(){this.removeDataTable(),Backbone.View.prototype.remove.call(this)},removeDataTable:function(){this.dataTable&&this.dataTable.destroy()},render:function(){var r=this,i=_.result(this,"configuration"),s=i.columns=_.result(i,"columns"),e=i.serverSide=_.result(i,"serverSide");return Promise.resolve(this.removeDataTable()).then(function(){for(var t=[],e=0,a=s.length;e<a;e++){var n=s[e];n.preRender&&t.push(n.preRender(n,i,r))}return Promise.all(t)}).then(function(){r.$el.html(r.template({configuration:i,view:r}))}).then(function(){var t=$.extend({orderCellsTop:!0},i);!0===e?$.extend(t,{ajax:function(o,t){var e={$count:!0},a=o.columns.filter(function(t){return t.searchable&&t.search&&t.search.value}).map(function(t){return t.search.value}).join(" and ");a&&(e.$filter=a);var n=o.order.map(function(t){var e=o.columns[t.column].data,a=_.result(i.columns[t.column],"orderBy"),n=_.result(i.columns[t.column],"dataType");return a?e=a:n&&"string"===n&&(e="tolower("+e+")"),e+" "+t.dir}).join(",");n&&(e.$orderby=n),o.search&&o.search.value&&(e.$search='"'+o.search.value+'"'),e.$skip=o.start,e.$top=o.length;var l=function(){t({data:r.collection.toJSON({transform:!1}),draw:o.draw,recordsTotal:r.collection.totalRecords||0,recordsFiltered:r.collection.totalRecords||0})};r.collection.fetch({fetchParameters:e}).then(l,l)}}):$.extend(t,{data:r.collection.toJSON()}),r.dataTable=r.$el.find("table").DataTable(t)}).then(function(){for(var t=[],e=0,a=s.length;e<a;e++){var n=s[e];if(n.postRender&&t.push(n.postRender(n,r.configuration,r)),null!=n.events){null==r.events&&(r.events={});var o=_.result($.extend({view:r},n),"events");for(var l in o)r.events[l]=o[l]}}return r.delegateEvents(),Promise.all(t)}).then(function(){$("thead input, thead select, tfoot input, tfoot select",r.$el).change()}).catch(function(t){t&&(alert("An error occured. "+t),window.console&&console.error&&console.error(t))})}},{buttonsConfiguration:function(){return{buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"},title:this.title},{extend:"csvHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"},title:this.title},{extend:"excelHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"},title:this.title},{extend:"pdfHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"},title:this.title},{extend:"print",exportOptions:{columns:":visible:not(.excludeFromButtons)"},title:this.title}],dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'<'table-responsive'tr>>><'row'<'col-sm-5'i><'col-sm-7'p>>B"}},columnFilters:{booleanEquals:function(t,e,a){var n="";e&&(t?"$EMPTY"===e?n=a.dataSrc()+" eq null":"$NOTEMPTY"===e?n=a.dataSrc()+" ne null":"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(n=a.dataSrc()+" eq "+e.toLowerCase()):n=e),n!==a.search()&&(a.search(n),a.draw())},numberEquals:function(t,e,a){var n="";e&&(t?"$EMPTY"===e?n=a.dataSrc()+" eq null":"$NOTEMPTY"===e?n=a.dataSrc()+" ne null":isNaN(e)||(n=a.dataSrc()+" eq "+e.toLowerCase()):n=e),n!==a.search()&&(a.search(n),a.draw())},numberBetween:function(t,e,a){var n="";if(e)if(t){if("$EMPTY"===e)n=a.dataSrc()+" eq null";else if("$NOTEMPTY"===e)n=a.dataSrc()+" ne null";else if(-1!==e.toLowerCase().indexOf("to")){var o=e.toLowerCase().split("to");if(!isNaN(o[0])||!isNaN(o[0])){var l=[];isNaN(o[0])?l[0]=null:l[0]=a.dataSrc()+" ge "+o[0],isNaN(o[1])?l[1]=null:l[1]=a.dataSrc()+" le "+o[1],n=l.filter(function(t){return t}).join(" and ")}}}else n=e;n!==a.search()&&(a.search(n),a.draw())},stringEquals:function(t,e,a){var n="";e&&(n=t?"$EMPTY"===e?a.dataSrc()+" eq null":"$NOTEMPTY"===e?a.dataSrc()+" ne null":a.dataSrc()+" eq '"+e.replace("'","''")+"'":e),n!==a.search()&&(a.search(n),a.draw())},stringContains:function(t,e,a){var n="";if(e)if(t)if("$EMPTY"===e)n=a.dataSrc()+" eq null";else if("$NOTEMPTY"===e)n=a.dataSrc()+" ne null";else{for(var o=e.toLowerCase().split(" "),l=[],r=0,i=o.length;r<i;r++)l.push("contains(tolower("+a.dataSrc()+"),'"+o[r].toLowerCase().replace("'","''")+"')");n=l.join(" and ")}else n=e;n!==a.search()&&(a.search(n),a.draw())},dateEquals:function(t,e,a){var n="";if(e)if(t){if("$EMPTY"===e)n=a.dataSrc()+" eq null";else if("$NOTEMPTY"===e)n=a.dataSrc()+" ne null";else if(moment(e,"l").isValid()){var o=moment(e,"l").set({hour:0,minute:0,second:0,millisecond:0}).format(),l=moment(o).add({hours:24}).format();n=a.dataSrc()+" ge "+o+" and "+a.dataSrc()+" le "+l}}else n=e;n!==a.search()&&(a.search(n),a.draw())},dateBetween:function(t,e,a){var n="";if(e)if(t){if("$EMPTY"===e)n=a.dataSrc()+" eq null";else if("$NOTEMPTY"===e)n=a.dataSrc()+" ne null";else if(-1!==e.toLowerCase().indexOf("to")){var o=e.toLowerCase().split("to");if(moment(o[0]).isValid()||moment(o[1]).isValid()){var l=[];if(moment(o[0]).isValid()){var r=moment(o[0]).set({hour:0,minute:0,second:0,millisecond:0}).format();l[0]=a.dataSrc()+" ge "+r}else l[0]=null;if(moment(o[1]).isValid()){var i=moment(o[1]).set({hour:0,minute:0,second:0,millisecond:0}).add({hours:24}).format();l[1]=a.dataSrc()+" le "+i}else l[1]=null;n=l.filter(function(t){return t}).join(" and ")}}}else n=e;n!==a.search()&&(a.search(n),a.draw())}},columns:{id:{data:"id",title:"ID"}},preRenders:{filterHtmlFactory:function(i,a){return"string"==typeof i&&(i=DataTableView.columnFilters[i]),function(n,l,r){return Promise.resolve().then(function(){if(n.choices&&"string"==typeof n.choices)return new Promise(function(e){var t=n.choices;n.choices=[],$.getJSON(t).then(function(t){Array.isArray(t)&&(n.choices=t),e()},function(){e()})})}).then(function(){n.choices?((0===n.choices.length||null!=n.choices[0].value&&""!==n.choices[0].value||null==n.choices[0].value&&""!==n.choices[0].text)&&n.choices.unshift({text:""}),n.headerHtml='\n\t\t\t\t\t\t\t<label class="sr-only" for="'+n.data+"_header_"+r.cid+'">Filter '+(n.title||n.data)+'</label>\n\t\t\t\t\t\t\t<select class="form-control" id="'+n.data+"_header_"+r.cid+'">\n\t\t\t\t\t\t\t\t'+n.choices.map(function(t){return'<option value="'+(null!=t.value?t.value:t.text)+'"'+(null!=t.value&&t.value===a||null==t.value&&t.text===a?" selected":"")+">"+t.text+"</option>"}).join("")+"\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t",n.footerHtml='\n\t\t\t\t\t\t\t<label class="sr-only" for="'+n.data+"_footer_"+r.cid+'">Filter '+(n.title||n.data)+'</label>\n\t\t\t\t\t\t\t<select class="form-control" id="'+n.data+"_footer_"+r.cid+'">\n\t\t\t\t\t\t\t\t'+n.choices.map(function(t){return'<option value="'+(null!=t.value?t.value:t.text)+'"'+(null!=t.value&&t.value===a||null==t.value&&t.text===a?" selected":"")+">"+t.text+"</option>"}).join("")+"\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t"):(n.headerHtml='\n\t\t\t\t\t\t\t<label class="sr-only" for="'+n.data+"_header_"+r.cid+'">Filter '+(n.title||n.data)+'</label>\n\t\t\t\t\t\t\t<input type="text" class="form-control" id="'+n.data+"_header_"+r.cid+'"'+(a?' value="'+a+'"':"")+">\n\t\t\t\t\t\t",n.footerHtml='\n\t\t\t\t\t\t\t<label class="sr-only" for="'+n.data+"_footer_"+r.cid+'">Filter '+(n.title||n.data)+'</label>\n\t\t\t\t\t\t\t<input type="text" class="form-control" id="'+n.data+"_footer_"+r.cid+'"'+(a?' value="'+a+'"':"")+">\n\t\t\t\t\t\t"),i===DataTableView.columnFilters.dateBetween?n.postRender=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};return function(t,e,a){n.call(void 0,t,e,a),$("#"+t.data+"_header_"+a.cid+", #"+t.data+"_footer_"+a.cid,a.$el).each(function(t,e){var a=$(e);a.daterangepicker({autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),a.on("apply.daterangepicker",function(t,e){$(this).val(e.startDate.format("YYYY/MM/DD/")+" to "+e.endDate.format("YYYY/MM/DD")).change()}),a.on("cancel.daterangepicker",function(){$(this).val("")})})}}(n.postRender):DataTableView.columnFilters.dateEquals,n.events||(n.events={});var o=function(t){var e=$("#"+n.data+"_header_"+r.cid);e.val()!==t&&e.val(t);var a=$("#"+n.data+"_footer_"+r.cid);a.val()!==t&&a.val(t)},t=function(t){var e=$(t.target),a=e.val(),n=+e.closest("td, th").data("index");o(a),i(l.serverSide,a,r.dataTable.column(n))};n.events["change #"+n.data+"_header_"+r.cid]=t,n.events["change #"+n.data+"_footer_"+r.cid]=t;var e=function(t){var e=$(t.target),a=e.val(),n=+e.closest("td, th").data("index");o(a),i(l.serverSide,a,r.dataTable.column(n))};n.events["keyup #"+n.data+"_header_"+r.cid]=e,n.events["keyup #"+n.data+"_footer_"+r.cid]=e})}}}});
//# sourceMappingURL=datatable_view.min.js.map
