"use strict";var DataTableView=Backbone.View.extend({className:"DataTableView",configuration:{columns:function(){return[DataTableView.columns.id]}},dataTable:null,template:_.template("\x3c!-- datatable_view.template.html --\x3e\n<div class=\"row\">\n\t<div class=\"col-xs-12\">\n\t\t<table width=\"100%\" class=\"table table-bordered\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t<% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<%- _.result(configuration.columns[index], 'title') || _.result(configuration.columns[index], 'data', '') %>\n\t\t\t\t\t</th>\n\t\t\t\t<% } %>\n\t\t\t\t</tr>\n\t\t\t\t<% if (configuration.showHeaderHtml !== false) { %>\n\t\t\t\t<tr>\n\t\t\t\t<% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n\t\t\t\t\t<th class=\"<%- _.result(configuration.columns[index], 'className', '') %>\">\n\t\t\t\t\t\t<%= _.result($.extend({view: view }, configuration.columns[index]), 'headerHtml', '') %>\n\t\t\t\t\t</th>\n\t\t\t\t<% } %>\n\t\t\t\t</tr>\n\t\t\t\t<% } %>\n\t\t\t</thead>\n\t\t\t<tbody></tbody>\n\t\t\t<% if (configuration.showFooterHtml !== false) { %>\n\t\t\t<tfoot>\n\t\t\t\t<tr>\n\t\t\t\t<% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n\t\t\t\t\t<td class=\"<%- _.result(configuration.columns[index], 'className', '') %>\">\n\t\t\t\t\t\t<%= _.result($.extend({view: view }, configuration.columns[index]), 'footerHtml', '') %>\n\t\t\t\t\t</td>\n\t\t\t\t<% } %>\n\t\t\t\t</tr>\n\t\t\t</tfoot>\n\t\t\t<% } %>\n\t\t</table>\n\t</div>\n</div>\n"),reload:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.dataTable&&this.dataTable.ajax.reload(t,e)},remove:function(){this.removeDataTable(),Backbone.View.prototype.remove.call(this)},removeDataTable:function(){this.dataTable&&this.dataTable.destroy()},render:function(){var l=this,o=_.result(this,"configuration"),i=o.columns=_.result(o,"columns");return Promise.resolve(this.removeDataTable()).then(function(){for(var t=[],e=0,n=i.length;e<n;e++){var a=i[e];a.preRender&&t.push(a.preRender(a,o,l))}return Promise.all(t)}).then(function(){l.$el.html(l.template({configuration:o,view:l}))}).then(function(){var t=$.extend({orderCellsTop:!0},o);!0===o.serverSide?$.extend(t,{ajax:function(e,t){var n={$count:!0},a=e.columns.filter(function(t){return t.searchable&&t.search&&t.search.value}).map(function(t){return t.search.value}).join(" and ");a&&(n.$filter=a);var o=e.order.map(function(t){return e.columns[t.column].data+" "+t.dir}).join(",");o&&(n.$orderby=o),e.search&&e.search.value&&(n.$search='"'+e.search.value+'"'),n.$skip=e.start,n.$top=e.length;var r=function(){t({data:l.collection.toJSON({transform:!1}),draw:e.draw,recordsTotal:l.collection.totalRecords||0,recordsFiltered:l.collection.totalRecords||0})};l.collection.fetch({fetchParameters:n}).then(r,r)}}):$.extend(t,{data:l.collection.toJSON()}),l.dataTable=l.$el.find("table").DataTable(t)}).then(function(){for(var t=[],e=0,n=i.length;e<n;e++){var a=i[e];if(a.postRender&&t.push(a.postRender(a,l.configuration,l)),null!=a.events){null==l.events&&(l.events={});var o=_.result($.extend({view:l},a),"events");for(var r in o)l.events[r]=o[r]}}return l.delegateEvents(),Promise.all(t)}).catch(function(t){t&&(alert("An error occured. "+t),window.console&&console.error&&console.error(t))})}},{buttonsConfiguration:{buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"csvHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"excelHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"pdfHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"print",exportOptions:{columns:":visible:not(.excludeFromButtons)"}}],dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'<'table-responsive'tr>>><'row'<'col-sm-5'i><'col-sm-7'p>>B"},columnFilters:{booleanEquals:function(t,e,n){var a="";e&&(t?"$EMPTY"===e?a=n.dataSrc()+" eq null":"$NOTEMPTY"===e?a=n.dataSrc()+" ne null":"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(a=n.dataSrc()+" eq "+e.toLowerCase()):a=e),a!==n.search()&&(n.search(a),n.draw())},numberEquals:function(t,e,n){var a="";e&&(t?"$EMPTY"===e?a=n.dataSrc()+" eq null":"$NOTEMPTY"===e?a=n.dataSrc()+" ne null":isNaN(e)||(a=n.dataSrc()+" eq "+e.toLowerCase()):a=e),a!==n.search()&&(n.search(a),n.draw())},numberBetween:function(t,e,n){var a="";if(e)if(t){if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else if(-1!==e.toLowerCase().indexOf("to")){var o=e.toLowerCase().split("to");if(!isNaN(o[0])||!isNaN(o[0])){var r=[];isNaN(o[0])?r[0]=null:r[0]=n.dataSrc()+" ge "+o[0],isNaN(o[1])?r[1]=null:r[1]=n.dataSrc()+" le "+o[1],a=r.filter(function(t){return t}).join(" and ")}}}else a=e;a!==n.search()&&(n.search(a),n.draw())},stringEquals:function(t,e,n){var a="";e&&(a=t?"$EMPTY"===e?n.dataSrc()+" eq null":"$NOTEMPTY"===e?n.dataSrc()+" ne null":"tolower("+n.dataSrc()+") eq '"+e.toLowerCase()+"'":e),a!==n.search()&&(n.search(a),n.draw())},stringContains:function(t,e,n){var a="";if(e)if(t)if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else{for(var o=e.toLowerCase().split(" "),r=[],l=0,i=o.length;l<i;l++)r.push("contains(tolower("+n.dataSrc()+"),'"+o[l]+"')");a=r.join(" and ")}else a=e;a!==n.search()&&(n.search(a),n.draw())},dateEquals:function(t,e,n){var a="";if(e)if(t){if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else if(moment(e,"l").isValid()){var o=moment(e,"l").set({hour:0,minute:0,second:0,millisecond:0}).format(),r=moment(o).add({hours:24}).format();a=n.dataSrc()+" ge "+o+" and "+n.dataSrc()+" le "+r}}else a=e;a!==n.search()&&(n.search(a),n.draw())},dateBetween:function(t,e,n){var a="";if(e)if(t){if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else if(-1!==e.toLowerCase().indexOf("to")){var o=e.toLowerCase().split("to");if(moment(o[0]).isValid()||moment(o[1]).isValid()){var r=[];if(moment(o[0]).isValid()){var l=moment(o[0]).set({hour:0,minute:0,second:0,millisecond:0}).format();r[0]=n.dataSrc()+" ge "+l}else r[0]=null;if(moment(o[1]).isValid()){var i=moment(o[1]).set({hour:0,minute:0,second:0,millisecond:0}).add({hours:24}).format();r[1]=n.dataSrc()+" le "+i}else r[1]=null;a=r.filter(function(t){return t}).join(" and ")}}}else a=e;a!==n.search()&&(n.search(a),n.draw())}},columns:{id:{data:"id",title:"ID"}},preRenders:{filterHtmlFactory:function(i){return"string"==typeof i&&(i=DataTableView.columnFilters[i]),function(a,r,l){return Promise.resolve().then(function(){if(a.choices&&"string"==typeof a.choices)return new Promise(function(e){var t=a.choices;a.choices=[],$.getJSON(t).then(function(t){Array.isArray(t)&&(a.choices=t),e()},function(){e()})})}).then(function(){a.choices?((0===a.choices.length||null!=a.choices[0].value&&""!==a.choices[0].value||null==a.choices[0].value&&""!==a.choices[0].text)&&a.choices.unshift({text:""}),a.headerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_header_"+l.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<select class="form-control" id="'+a.data+"_header_"+l.cid+'">\n\t\t\t\t\t\t\t\t\t'+a.choices.map(function(t){return'<option value="'+(null!=t.value?t.value:t.text)+'">'+t.text+"</option>"}).join("")+"\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t",a.footerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_footer_"+l.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<select class="form-control" id="'+a.data+"_footer_"+l.cid+'">\n\t\t\t\t\t\t\t\t\t'+a.choices.map(function(t){return'<option value="'+(null!=t.value?t.value:t.text)+'">'+t.text+"</option>"}).join("")+"\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t"):(a.headerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_header_"+l.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<input type="text" class="form-control" id="'+a.data+"_header_"+l.cid+'">\n\t\t\t\t\t\t\t',a.footerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_footer_"+l.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<input type="text" class="form-control" id="'+a.data+"_footer_"+l.cid+'">\n\t\t\t\t\t\t\t'),a.events||(a.events={});var o=function(t){var e=$("#"+a.data+"_header_"+l.cid);e.val()!==t&&e.val(t);var n=$("#"+a.data+"_footer_"+l.cid);n.val()!==t&&n.val(t)},t=function(t){var e=$(t.target),n=e.val(),a=e.closest("tr").children("td, th").index(e.closest("td, th"));o(n),i(r.serverSide,n,l.dataTable.column(a))};a.events["change #"+a.data+"_header_"+l.cid]=t,a.events["change #"+a.data+"_footer_"+l.cid]=t;var e=function(t){var e=$(t.target),n=e.val(),a=e.closest("tr").children("td, th").index(e.closest("td, th"));o(n),i(r.serverSide,n,l.dataTable.column(a))};a.events["keyup #"+a.data+"_header_"+l.cid]=e,a.events["keyup #"+a.data+"_footer_"+l.cid]=e})}}}});
//# sourceMappingURL=datatable_view.min.js.map
