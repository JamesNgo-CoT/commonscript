"use strict";var DataTableView=Backbone.View.extend({className:"DataTableView",configuration:{columns:function(){return[DataTableView.columns.id]}},dataTable:null,template:_.template("\x3c!-- datatable_view.template.html --\x3e\n<div class=\"row\">\n\t<div class=\"col-xs-12\">\n\t\t<table width=\"100%\" class=\"table table-bordered\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t<% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<%- _.result(configuration.columns[index], 'title') || _.result(configuration.columns[index], 'data', '') %>\n\t\t\t\t\t</th>\n\t\t\t\t<% } %>\n\t\t\t\t</tr>\n\t\t\t\t<% if (configuration.showHeaderHtml !== false) { %>\n\t\t\t\t<tr>\n\t\t\t\t<% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n\t\t\t\t\t<th class=\"<%- _.result(configuration.columns[index], 'className', '') %>\">\n\t\t\t\t\t\t<%= _.result($.extend({view: view }, configuration.columns[index]), 'headerHtml', '') %>\n\t\t\t\t\t</th>\n\t\t\t\t<% } %>\n\t\t\t\t</tr>\n\t\t\t\t<% } %>\n\t\t\t</thead>\n\t\t\t<tbody></tbody>\n\t\t\t<% if (configuration.showFooterHtml !== false) { %>\n\t\t\t<tfoot>\n\t\t\t\t<tr>\n\t\t\t\t<% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n\t\t\t\t\t<td class=\"<%- _.result(configuration.columns[index], 'className', '') %>\">\n\t\t\t\t\t\t<%= _.result($.extend({view: view }, configuration.columns[index]), 'footerHtml', '') %>\n\t\t\t\t\t</td>\n\t\t\t\t<% } %>\n\t\t\t\t</tr>\n\t\t\t</tfoot>\n\t\t\t<% } %>\n\t\t</table>\n\t</div>\n</div>\n"),resetFilters:function(){$('tfoot input[type="text"], thead input[type="text"]',this.$el).each(function(t,e){$(e).val($(e).attr("value")||"").change()}),$("tfoot select, thead select",this.$el).each(function(t,e){var n=$(e).find("[selected]"),a=n.attr("value");$(e).val(null!=a?a:n.text()).change()})},reload:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.dataTable&&this.dataTable.ajax.reload(t,e)},remove:function(){this.removeDataTable(),Backbone.View.prototype.remove.call(this)},removeDataTable:function(){this.dataTable&&this.dataTable.destroy()},render:function(){var r=this,i=_.result(this,"configuration"),s=i.columns=_.result(i,"columns"),e=i.serverSide=_.result(i,"serverSide");return Promise.resolve(this.removeDataTable()).then(function(){for(var t=[],e=0,n=s.length;e<n;e++){var a=s[e];a.preRender&&t.push(a.preRender(a,i,r))}return Promise.all(t)}).then(function(){r.$el.html(r.template({configuration:i,view:r}))}).then(function(){var t=$.extend({orderCellsTop:!0},i);!0===e?$.extend(t,{ajax:function(l,t){var e={$count:!0},n=l.columns.filter(function(t){return t.searchable&&t.search&&t.search.value}).map(function(t){return t.search.value}).join(" and ");n&&(e.$filter=n);var a=l.order.map(function(t){var e=l.columns[t.column].data,n=_.result(i.columns[t.column],"orderBy"),a=_.result(i.columns[t.column],"dataType");return n?e=n:a&&"string"===a&&(e="tolower("+e+")"),e+" "+t.dir}).join(",");a&&(e.$orderby=a),l.search&&l.search.value&&(e.$search='"'+l.search.value+'"'),e.$skip=l.start,e.$top=l.length;var o=function(){t({data:r.collection.toJSON({transform:!1}),draw:l.draw,recordsTotal:r.collection.totalRecords||0,recordsFiltered:r.collection.totalRecords||0})};r.collection.fetch({fetchParameters:e}).then(o,o)}}):$.extend(t,{data:r.collection.toJSON()}),r.dataTable=r.$el.find("table").DataTable(t)}).then(function(){for(var t=[],e=0,n=s.length;e<n;e++){var a=s[e];if(a.postRender&&t.push(a.postRender(a,r.configuration,r)),null!=a.events){null==r.events&&(r.events={});var l=_.result($.extend({view:r},a),"events");for(var o in l)r.events[o]=l[o]}}return r.delegateEvents(),Promise.all(t)}).then(function(){$("thead input, thead select, tfoot input, tfoot select",r.$el).change()}).catch(function(t){t&&(alert("An error occured. "+t),window.console&&console.error&&console.error(t))})}},{buttonsConfiguration:{buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"csvHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"excelHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"pdfHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"print",exportOptions:{columns:":visible:not(.excludeFromButtons)"}}],dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'<'table-responsive'tr>>><'row'<'col-sm-5'i><'col-sm-7'p>>B"},columnFilters:{booleanEquals:function(t,e,n){var a="";e&&(t?"$EMPTY"===e?a=n.dataSrc()+" eq null":"$NOTEMPTY"===e?a=n.dataSrc()+" ne null":"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(a=n.dataSrc()+" eq "+e.toLowerCase()):a=e),a!==n.search()&&(n.search(a),n.draw())},numberEquals:function(t,e,n){var a="";e&&(t?"$EMPTY"===e?a=n.dataSrc()+" eq null":"$NOTEMPTY"===e?a=n.dataSrc()+" ne null":isNaN(e)||(a=n.dataSrc()+" eq "+e.toLowerCase()):a=e),a!==n.search()&&(n.search(a),n.draw())},numberBetween:function(t,e,n){var a="";if(e)if(t){if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else if(-1!==e.toLowerCase().indexOf("to")){var l=e.toLowerCase().split("to");if(!isNaN(l[0])||!isNaN(l[0])){var o=[];isNaN(l[0])?o[0]=null:o[0]=n.dataSrc()+" ge "+l[0],isNaN(l[1])?o[1]=null:o[1]=n.dataSrc()+" le "+l[1],a=o.filter(function(t){return t}).join(" and ")}}}else a=e;a!==n.search()&&(n.search(a),n.draw())},stringEquals:function(t,e,n){var a="";e&&(a=t?"$EMPTY"===e?n.dataSrc()+" eq null":"$NOTEMPTY"===e?n.dataSrc()+" ne null":"tolower("+n.dataSrc()+") eq '"+e.toLowerCase()+"'":e),a!==n.search()&&(n.search(a),n.draw())},stringContains:function(t,e,n){var a="";if(e)if(t)if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else{for(var l=e.toLowerCase().split(" "),o=[],r=0,i=l.length;r<i;r++)o.push("contains(tolower("+n.dataSrc()+"),'"+l[r]+"')");a=o.join(" and ")}else a=e;a!==n.search()&&(n.search(a),n.draw())},dateEquals:function(t,e,n){var a="";if(e)if(t){if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else if(moment(e,"l").isValid()){var l=moment(e,"l").set({hour:0,minute:0,second:0,millisecond:0}).format(),o=moment(l).add({hours:24}).format();a=n.dataSrc()+" ge "+l+" and "+n.dataSrc()+" le "+o}}else a=e;a!==n.search()&&(n.search(a),n.draw())},dateBetween:function(t,e,n){var a="";if(e)if(t){if("$EMPTY"===e)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===e)a=n.dataSrc()+" ne null";else if(-1!==e.toLowerCase().indexOf("to")){var l=e.toLowerCase().split("to");if(moment(l[0]).isValid()||moment(l[1]).isValid()){var o=[];if(moment(l[0]).isValid()){var r=moment(l[0]).set({hour:0,minute:0,second:0,millisecond:0}).format();o[0]=n.dataSrc()+" ge "+r}else o[0]=null;if(moment(l[1]).isValid()){var i=moment(l[1]).set({hour:0,minute:0,second:0,millisecond:0}).add({hours:24}).format();o[1]=n.dataSrc()+" le "+i}else o[1]=null;a=o.filter(function(t){return t}).join(" and ")}}}else a=e;a!==n.search()&&(n.search(a),n.draw())}},columns:{id:{data:"id",title:"ID"}},preRenders:{filterHtmlFactory:function(i,n){return"string"==typeof i&&(i=DataTableView.columnFilters[i]),function(a,o,r){return Promise.resolve().then(function(){if(a.choices&&"string"==typeof a.choices)return new Promise(function(e){var t=a.choices;a.choices=[],$.getJSON(t).then(function(t){Array.isArray(t)&&(a.choices=t),e()},function(){e()})})}).then(function(){a.choices?((0===a.choices.length||null!=a.choices[0].value&&""!==a.choices[0].value||null==a.choices[0].value&&""!==a.choices[0].text)&&a.choices.unshift({text:""}),a.headerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_header_"+r.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<select class="form-control" id="'+a.data+"_header_"+r.cid+'">\n\t\t\t\t\t\t\t\t\t'+a.choices.map(function(t){return'<option value="'+(null!=t.value?t.value:t.text)+'"'+(null!=t.value&&t.value===n||null==t.value&&t.text===n?" selected":"")+">"+t.text+"</option>"}).join("")+"\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t",a.footerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_footer_"+r.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<select class="form-control" id="'+a.data+"_footer_"+r.cid+'">\n\t\t\t\t\t\t\t\t\t'+a.choices.map(function(t){return'<option value="'+(null!=t.value?t.value:t.text)+'"'+(null!=t.value&&t.value===n||null==t.value&&t.text===n?" selected":"")+">"+t.text+"</option>"}).join("")+"\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t"):(a.headerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_header_"+r.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<input type="text" class="form-control" id="'+a.data+"_header_"+r.cid+'"'+(n?' value="'+n+'"':"")+">\n\t\t\t\t\t\t\t",a.footerHtml='\n\t\t\t\t\t\t\t\t<label class="sr-only" for="'+a.data+"_footer_"+r.cid+'">Filter '+(a.title||a.data)+'</label>\n\t\t\t\t\t\t\t\t<input type="text" class="form-control" id="'+a.data+"_footer_"+r.cid+'"'+(n?' value="'+n+'"':"")+">\n\t\t\t\t\t\t\t"),a.events||(a.events={});var l=function(t){var e=$("#"+a.data+"_header_"+r.cid);e.val()!==t&&e.val(t);var n=$("#"+a.data+"_footer_"+r.cid);n.val()!==t&&n.val(t)},t=function(t){var e=$(t.target),n=e.val(),a=e.closest("tr").children("td, th").index(e.closest("td, th"));l(n),i(o.serverSide,n,r.dataTable.column(a))};a.events["change #"+a.data+"_header_"+r.cid]=t,a.events["change #"+a.data+"_footer_"+r.cid]=t;var e=function(t){var e=$(t.target),n=e.val(),a=e.closest("tr").children("td, th").index(e.closest("td, th"));l(n),i(o.serverSide,n,r.dataTable.column(a))};a.events["keyup #"+a.data+"_header_"+r.cid]=e,a.events["keyup #"+a.data+"_footer_"+r.cid]=e})}}}});
//# sourceMappingURL=datatable_view.min.js.map
