"use strict";var FormView=Backbone.View.extend({className:"FormView",definition:null,rootPath:"/* @echo SRC_PATH *//",template:_.template('\n<div class="formWrapper"></div>\n'),template_buttons:_.template('\n<div class="hidden-print btns-bar row">\n\t<div class="col-xs-12">\n\t\t<button type="submit" class="btn btn-primary btn-lg btn-submit">Submit</button>\n\t</div>\n</div>\n'),render:function(){var i=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.$el.html(this.template({model:this.model}));for(var e=_.result(this,"definition"),n=$.extend({},e,{id:e.id||"form_"+this.model.cid,rootPath:_.result(this,"rootPath"),success:e.success||t.success||function(e){return e.preventDefault(),Promise.resolve().then(function(){if(null!=t.beforeSave)return t.beforeSave()}).then(function(){return new Promise(function(o,r){i.model.save(null,{$originatingElement:$(t.originatingElementSelector||".btn-submit",i.$el)}).then(function(e,t,n){i.trigger("saved",e,t,n),o(e)},function(e,t,n){i.trigger("savefailed",e,t,n),r(n)})})}).catch(function(e){e&&(alert("An error occured. "+e),window.console&&console.error&&console.error(e))}),!1},useBinding:!0}),o=[],r=0,s=n.sections.length;r<s;r++)for(var c=n.sections[r],l=0,a=c.rows.length;l<a;l++)for(var u=c.rows[l],d=function(e,t){var n=u.fields[e];n.choices&&"string"==typeof n.choices&&o.push(new Promise(function(t){var e=n.choices;n.choices=[],$.getJSON(e).then(function(e){Array.isArray(e)&&(n.choices=e),t()},function(){t()})}))},f=0,h=u.fields.length;f<h;f++)d(f);return Promise.all(o).then(function(){var e=new ExtendedCotForm(n);return e.setModel(i.model),e.render({target:$(".formWrapper",i.$el),view:i}).then(function(){$(".formWrapper form",i.$el).append(i.template_buttons({model:i.model}))}).then(function(){var e=$("a.btn",i.$el).not('[role="button"]');e.attr("role","button"),e.on("keydown",function(e){32===e.which&&(e.preventDefault(),e.target.click())})})}).catch(function(e){e&&window.console&&console.error&&console.error("An error occured.",e)})}});
//# sourceMappingURL=form_view.min.js.map
