{"version":3,"sources":["scripts/form_view.min.js"],"names":["FormView","Backbone","View","extend","className","definition","rootPath","template","template_buttons","render","_this","this","options","arguments","length","undefined","$el","html","model","_","result","formDefinition","$","id","cid","success","event","preventDefault","Promise","resolve","then","beforeSave","reject","save","$originatingElement","originatingElementSelector","data","textStatus","jqXHR","trigger","errorThrown","catch","error","alert","window","console","useBinding","choicesPromises","sectionsIndex","sectionsLength","sections","section","rowsIndex","rowsLength","rows","row","_loop","fieldsIndex","fieldsLength","field","fields","choices","push","url","getJSON","Array","isArray","all","form","ExtendedCotForm","setModel","target","view","append","$linkButton","not","attr","on","which","click"],"mappings":"AAAA,aAKA,IAAIA,SAAWC,SAASC,KAAKC,OAAO,CAInCC,UAAW,WAEXC,WAAY,KAEZC,SAAU,wBAEVC,SAAU,WACT,MAAO,mCAGRC,iBAAkB,WACjB,MAAO,uMAKRC,OAAQ,WACP,IAAIC,EAAQC,KAERC,EAA6B,EAAnBC,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAElFF,KAAKK,IAAIC,KAAKN,KAAKJ,SAAS,CAC3BW,MAAOP,KAAKO,SA4Cb,IAzCA,IAAIb,EAAac,EAAEC,OAAOT,KAAM,cAC5BU,EAAiBC,EAAEnB,OAAO,GAAIE,EAAY,CAC7CkB,GAAIlB,EAAe,IAAK,QAAUM,KAAKO,MAAMM,IAE7ClB,SAAUa,EAAEC,OAAOT,KAAM,YAEzBc,QAASpB,EAAoB,SAAKO,EAAQa,SAAW,SAAUC,GA4B9D,OA3BAA,EAAMC,iBAENC,QAAQC,UAAUC,KAAK,WACtB,GAA0B,MAAtBlB,EAAQmB,WACX,OAAOnB,EAAQmB,eAEdD,KAAK,WACP,OAAO,IAAIF,QAAQ,SAAUC,EAASG,GACrCtB,EAAMQ,MAAMe,KAAK,KAAM,CAAEC,oBAAqBZ,EAAEV,EAAQuB,4BAA8B,cAAezB,EAAMM,OAAQc,KAAK,SAAUM,EAAMC,EAAYC,GACnJ5B,EAAM6B,QAAQ,QAASH,EAAMC,EAAYC,GACzCT,EAAQO,IACN,SAAUE,EAAOD,EAAYG,GAC/B9B,EAAM6B,QAAQ,aAAcD,EAAOD,EAAYG,GAC/CR,EAAOQ,SAGPC,MAAM,SAAUC,GACdA,IACHC,MAAM,qBAAuBD,GAEzBE,OAAOC,SAAWA,QAAQH,OAC7BG,QAAQH,MAAMA,OAMV,GAGRI,YAAY,IAGTC,EAAkB,GACbC,EAAgB,EAAGC,EAAiB5B,EAAe6B,SAASpC,OAAQkC,EAAgBC,EAAgBD,IAG5G,IAFA,IAAIG,EAAU9B,EAAe6B,SAASF,GAE7BI,EAAY,EAAGC,EAAaF,EAAQG,KAAKxC,OAAQsC,EAAYC,EAAYD,IAsBjF,IArBA,IAAIG,EAAMJ,EAAQG,KAAKF,GAEnBI,EAAQ,SAAeC,EAAaC,GACvC,IAAIC,EAAQJ,EAAIK,OAAOH,GAEnBE,EAAME,SAAoC,iBAAlBF,EAAME,SACjCd,EAAgBe,KAAK,IAAIlC,QAAQ,SAAUC,GAC1C,IAAIkC,EAAMJ,EAAME,QAChBF,EAAME,QAAU,GAChBvC,EAAE0C,QAAQD,GAAKjC,KAAK,SAAUM,GACzB6B,MAAMC,QAAQ9B,KACjBuB,EAAME,QAAUzB,GAEjBP,KACE,WACFA,UAMK4B,EAAc,EAAGC,EAAeH,EAAIK,OAAO9C,OAAQ2C,EAAcC,EAAcD,IACvFD,EAAMC,GAKT,OAAO7B,QAAQuC,IAAIpB,GAAiBjB,KAAK,WACxC,IAAIsC,EAAO,IAAIC,gBAAgBhD,GAG/B,OAFA+C,EAAKE,SAAS5D,EAAMQ,OAEbkD,EAAK3D,OAAO,CAClB8D,OAAQjD,EAAE,eAAgBZ,EAAMM,KAChCwD,KAAM9D,IACJoB,KAAK,WACKR,EAAE,oBAAqBZ,EAAMM,KACnCyD,OAAO/D,EAAMF,iBAAiB,CACnCU,MAAOR,EAAMQ,WAEZY,KAAK,WACP,IAAI4C,EAAcpD,EAAE,QAASZ,EAAMM,KAAK2D,IAAI,mBAC5CD,EAAYE,KAAK,OAAQ,UACzBF,EAAYG,GAAG,UAAW,SAAUnD,GACf,KAAhBA,EAAMoD,QACTpD,EAAMC,iBACND,EAAM6C,OAAOQ,eAIdtC,MAAM,SAAUC,GAEdA,GAASE,OAAOC,SAAWA,QAAQH,OACtCG,QAAQH,MAAM,oBAAqBA","file":"form_view.min.js","sourcesContent":["'use strict';\n\n/* global ExtendedCotForm */\n\n/* exported FormView */\nvar FormView = Backbone.View.extend({\n\n\t// MARK: PROPERTY DEFINITION\n\n\tclassName: 'FormView',\n\n\tdefinition: null,\n\n\trootPath: '/* @echo SRC_PATH *//',\n\n\ttemplate: function template() {\n\t\treturn '<div class=\"formWrapper\"></div>';\n\t},\n\n\ttemplate_buttons: function template_buttons() {\n\t\treturn '\\n\\t\\t<div class=\"hidden-print btns-bar row\">\\n\\t\\t\\t<div class=\"col-xs-12\">\\n\\t\\t\\t\\t<button type=\"submit\" class=\"btn btn-primary btn-lg btn-submit\">Submit</button>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t';\n\t},\n\n\t// MARK: METHOD DEFINITION\n\n\trender: function render() {\n\t\tvar _this = this;\n\n\t\tvar options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n\t\tthis.$el.html(this.template({\n\t\t\tmodel: this.model\n\t\t}));\n\n\t\tvar definition = _.result(this, 'definition');\n\t\tvar formDefinition = $.extend({}, definition, {\n\t\t\tid: definition['id'] || 'form_' + this.model.cid,\n\n\t\t\trootPath: _.result(this, 'rootPath'),\n\n\t\t\tsuccess: definition['success'] || options.success || function (event) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tPromise.resolve().then(function () {\n\t\t\t\t\tif (options.beforeSave != null) {\n\t\t\t\t\t\treturn options.beforeSave();\n\t\t\t\t\t}\n\t\t\t\t}).then(function () {\n\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t_this.model.save(null, { $originatingElement: $(options.originatingElementSelector || '.btn-submit', _this.$el) }).then(function (data, textStatus, jqXHR) {\n\t\t\t\t\t\t\t_this.trigger('saved', data, textStatus, jqXHR);\n\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t}, function (jqXHR, textStatus, errorThrown) {\n\t\t\t\t\t\t\t_this.trigger('savefailed', jqXHR, textStatus, errorThrown);\n\t\t\t\t\t\t\treject(errorThrown);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\talert('An error occured. ' + error);\n\t\t\t\t\t\t/* eslint-disable no-console */\n\t\t\t\t\t\tif (window.console && console.error) {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t/* eslint-enable no-console */\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t},\n\n\t\t\tuseBinding: true\n\t\t});\n\n\t\tvar choicesPromises = [];\n\t\tfor (var sectionsIndex = 0, sectionsLength = formDefinition.sections.length; sectionsIndex < sectionsLength; sectionsIndex++) {\n\t\t\tvar section = formDefinition.sections[sectionsIndex];\n\n\t\t\tfor (var rowsIndex = 0, rowsLength = section.rows.length; rowsIndex < rowsLength; rowsIndex++) {\n\t\t\t\tvar row = section.rows[rowsIndex];\n\n\t\t\t\tvar _loop = function _loop(fieldsIndex, fieldsLength) {\n\t\t\t\t\tvar field = row.fields[fieldsIndex];\n\n\t\t\t\t\tif (field.choices && typeof field.choices === 'string') {\n\t\t\t\t\t\tchoicesPromises.push(new Promise(function (resolve) {\n\t\t\t\t\t\t\tvar url = field.choices;\n\t\t\t\t\t\t\tfield.choices = [];\n\t\t\t\t\t\t\t$.getJSON(url).then(function (data) {\n\t\t\t\t\t\t\t\tif (Array.isArray(data)) {\n\t\t\t\t\t\t\t\t\tfield.choices = data;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfor (var fieldsIndex = 0, fieldsLength = row.fields.length; fieldsIndex < fieldsLength; fieldsIndex++) {\n\t\t\t\t\t_loop(fieldsIndex, fieldsLength);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(choicesPromises).then(function () {\n\t\t\tvar form = new ExtendedCotForm(formDefinition);\n\t\t\tform.setModel(_this.model);\n\n\t\t\treturn form.render({\n\t\t\t\ttarget: $('.formWrapper', _this.$el),\n\t\t\t\tview: _this\n\t\t\t}).then(function () {\n\t\t\t\tvar $form = $('.formWrapper form', _this.$el);\n\t\t\t\t$form.append(_this.template_buttons({\n\t\t\t\t\tmodel: _this.model\n\t\t\t\t}));\n\t\t\t}).then(function () {\n\t\t\t\tvar $linkButton = $('a.btn', _this.$el).not('[role=\"button\"]');\n\t\t\t\t$linkButton.attr('role', 'button');\n\t\t\t\t$linkButton.on('keydown', function (event) {\n\t\t\t\t\tif (event.which === 32) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.target.click();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}).catch(function (error) {\n\t\t\t/* eslint-disable no-console */\n\t\t\tif (error && window.console && console.error) {\n\t\t\t\tconsole.error('An error occured.', error);\n\t\t\t}\n\t\t\t/* eslint-enable no-console */\n\t\t});\n\t}\n});"]}