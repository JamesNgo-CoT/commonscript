{"version":3,"sources":["scripts/form_view.min.js"],"names":["FormView","Backbone","View","extend","className","definition","rootPath","template","_","template_buttons","render","_this","this","options","arguments","length","undefined","$el","html","model","result","formDefinition","$","id","cid","success","event","preventDefault","Promise","resolve","then","beforeSave","reject","save","data","textStatus","jqXHR","trigger","errorThrown","catch","error","alert","window","console","useBinding","choicesPromises","sectionsIndex","sectionsLength","sections","section","rowsIndex","rowsLength","rows","row","_loop","fieldsIndex","fieldsLength","field","fields","choices","push","url","getJSON","Array","isArray","all","form","ExtendedCotForm","setModel","target","view","append","$linkButton","not","attr","on","which","click"],"mappings":"AAAA,aAKA,IAAIA,SAAWC,SAASC,KAAKC,OAAO,CAInCC,UAAW,WAEXC,WAAY,KAEZC,SAAU,wBAEVC,SAAUC,EAAED,SAAS,6EAErBE,iBAAkBD,EAAED,SAAS,+NAI7BG,OAAQ,WACP,IAAIC,EAAQC,KAERC,EAA6B,EAAnBC,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAElFF,KAAKK,IAAIC,KAAKN,KAAKL,SAAS,CAC3BY,MAAOP,KAAKO,SA4Cb,IAzCA,IAAId,EAAaG,EAAEY,OAAOR,KAAM,cAC5BS,EAAiBC,EAAEnB,OAAO,GAAIE,EAAY,CAC7CkB,GAAIlB,EAAe,IAAK,QAAUO,KAAKO,MAAMK,IAE7ClB,SAAUE,EAAEY,OAAOR,KAAM,YAEzBa,QAASpB,EAAoB,SAAKQ,EAAQY,SAAW,SAAUC,GA4B9D,OA3BAA,EAAMC,iBAENC,QAAQC,UAAUC,KAAK,WACtB,GAA0B,MAAtBjB,EAAQkB,WACX,OAAOlB,EAAQkB,eAEdD,KAAK,WACP,OAAO,IAAIF,QAAQ,SAAUC,EAASG,GACrCrB,EAAMQ,MAAMc,OAAOH,KAAK,SAAUI,EAAMC,EAAYC,GACnDzB,EAAM0B,QAAQ,QAASH,EAAMC,EAAYC,GACzCP,EAAQK,IACN,SAAUE,EAAOD,EAAYG,GAC/B3B,EAAM0B,QAAQ,aAAcD,EAAOD,EAAYG,GAC/CN,EAAOM,SAGPC,MAAM,SAAUC,GACdA,IACHC,MAAM,qBAAuBD,GAEzBE,OAAOC,SAAWA,QAAQH,OAC7BG,QAAQH,MAAMA,OAMV,GAGRI,YAAY,IAGTC,EAAkB,GACbC,EAAgB,EAAGC,EAAiB1B,EAAe2B,SAASjC,OAAQ+B,EAAgBC,EAAgBD,IAG5G,IAFA,IAAIG,EAAU5B,EAAe2B,SAASF,GAE7BI,EAAY,EAAGC,EAAaF,EAAQG,KAAKrC,OAAQmC,EAAYC,EAAYD,IAsBjF,IArBA,IAAIG,EAAMJ,EAAQG,KAAKF,GAEnBI,EAAQ,SAAeC,EAAaC,GACvC,IAAIC,EAAQJ,EAAIK,OAAOH,GAEnBE,EAAME,SAAoC,iBAAlBF,EAAME,SACjCd,EAAgBe,KAAK,IAAIhC,QAAQ,SAAUC,GAC1C,IAAIgC,EAAMJ,EAAME,QAChBF,EAAME,QAAU,GAChBrC,EAAEwC,QAAQD,GAAK/B,KAAK,SAAUI,GACzB6B,MAAMC,QAAQ9B,KACjBuB,EAAME,QAAUzB,GAEjBL,KACE,WACFA,UAMK0B,EAAc,EAAGC,EAAeH,EAAIK,OAAO3C,OAAQwC,EAAcC,EAAcD,IACvFD,EAAMC,GAKT,OAAO3B,QAAQqC,IAAIpB,GAAiBf,KAAK,WACxC,IAAIoC,EAAO,IAAIC,gBAAgB9C,GAG/B,OAFA6C,EAAKE,SAASzD,EAAMQ,OAEb+C,EAAKxD,OAAO,CAClB2D,OAAQ/C,EAAE,eAAgBX,EAAMM,KAChCqD,KAAM3D,IACJmB,KAAK,WACKR,EAAE,oBAAqBX,EAAMM,KACnCsD,OAAO5D,EAAMF,iBAAiB,CAAEU,MAAOR,EAAMQ,WACjDW,KAAK,WACP,IAAI0C,EAAclD,EAAE,QAASX,EAAMM,KAAKwD,IAAI,mBAC5CD,EAAYE,KAAK,OAAQ,UACzBF,EAAYG,GAAG,UAAW,SAAUjD,GACf,KAAhBA,EAAMkD,QACTlD,EAAMC,iBACND,EAAM2C,OAAOQ,eAIdtC,MAAM,SAAUC,GAEdA,GAASE,OAAOC,SAAWA,QAAQH,OACtCG,QAAQH,MAAM,oBAAqBA","file":"form_view.min.js","sourcesContent":["'use strict';\n\n/* global ExtendedCotForm */\n\n/* exported FormView */\nvar FormView = Backbone.View.extend({\n\n\t// MARK: PROPERTY DEFINITION\n\n\tclassName: 'FormView',\n\n\tdefinition: null,\n\n\trootPath: '/* @echo SRC_PATH *//',\n\n\ttemplate: _.template('<!-- form_view.template.html -->\\n<div class=\"formWrapper\"></div>\\n'),\n\n\ttemplate_buttons: _.template('<!-- form_view.buttons.template.html -->\\n<div class=\"hidden-print btns-bar row\">\\n\\t<div class=\"col-xs-12\">\\n\\t\\t<button type=\"submit\" class=\"btn btn-primary btn-lg btn-submit\">Submit</button>\\n\\t</div>\\n</div>\\n'),\n\n\t// MARK: METHOD DEFINITION\n\n\trender: function render() {\n\t\tvar _this = this;\n\n\t\tvar options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n\t\tthis.$el.html(this.template({\n\t\t\tmodel: this.model\n\t\t}));\n\n\t\tvar definition = _.result(this, 'definition');\n\t\tvar formDefinition = $.extend({}, definition, {\n\t\t\tid: definition['id'] || 'form_' + this.model.cid,\n\n\t\t\trootPath: _.result(this, 'rootPath'),\n\n\t\t\tsuccess: definition['success'] || options.success || function (event) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tPromise.resolve().then(function () {\n\t\t\t\t\tif (options.beforeSave != null) {\n\t\t\t\t\t\treturn options.beforeSave();\n\t\t\t\t\t}\n\t\t\t\t}).then(function () {\n\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t_this.model.save().then(function (data, textStatus, jqXHR) {\n\t\t\t\t\t\t\t_this.trigger('saved', data, textStatus, jqXHR);\n\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t}, function (jqXHR, textStatus, errorThrown) {\n\t\t\t\t\t\t\t_this.trigger('savefailed', jqXHR, textStatus, errorThrown);\n\t\t\t\t\t\t\treject(errorThrown);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\talert('An error occured. ' + error);\n\t\t\t\t\t\t/* eslint-disable no-console */\n\t\t\t\t\t\tif (window.console && console.error) {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t/* eslint-enable no-console */\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t},\n\n\t\t\tuseBinding: true\n\t\t});\n\n\t\tvar choicesPromises = [];\n\t\tfor (var sectionsIndex = 0, sectionsLength = formDefinition.sections.length; sectionsIndex < sectionsLength; sectionsIndex++) {\n\t\t\tvar section = formDefinition.sections[sectionsIndex];\n\n\t\t\tfor (var rowsIndex = 0, rowsLength = section.rows.length; rowsIndex < rowsLength; rowsIndex++) {\n\t\t\t\tvar row = section.rows[rowsIndex];\n\n\t\t\t\tvar _loop = function _loop(fieldsIndex, fieldsLength) {\n\t\t\t\t\tvar field = row.fields[fieldsIndex];\n\n\t\t\t\t\tif (field.choices && typeof field.choices === 'string') {\n\t\t\t\t\t\tchoicesPromises.push(new Promise(function (resolve) {\n\t\t\t\t\t\t\tvar url = field.choices;\n\t\t\t\t\t\t\tfield.choices = [];\n\t\t\t\t\t\t\t$.getJSON(url).then(function (data) {\n\t\t\t\t\t\t\t\tif (Array.isArray(data)) {\n\t\t\t\t\t\t\t\t\tfield.choices = data;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfor (var fieldsIndex = 0, fieldsLength = row.fields.length; fieldsIndex < fieldsLength; fieldsIndex++) {\n\t\t\t\t\t_loop(fieldsIndex, fieldsLength);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(choicesPromises).then(function () {\n\t\t\tvar form = new ExtendedCotForm(formDefinition);\n\t\t\tform.setModel(_this.model);\n\n\t\t\treturn form.render({\n\t\t\t\ttarget: $('.formWrapper', _this.$el),\n\t\t\t\tview: _this\n\t\t\t}).then(function () {\n\t\t\t\tvar $form = $('.formWrapper form', _this.$el);\n\t\t\t\t$form.append(_this.template_buttons({ model: _this.model }));\n\t\t\t}).then(function () {\n\t\t\t\tvar $linkButton = $('a.btn', _this.$el).not('[role=\"button\"]');\n\t\t\t\t$linkButton.attr('role', 'button');\n\t\t\t\t$linkButton.on('keydown', function (event) {\n\t\t\t\t\tif (event.which === 32) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.target.click();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}).catch(function (error) {\n\t\t\t/* eslint-disable no-console */\n\t\t\tif (error && window.console && console.error) {\n\t\t\t\tconsole.error('An error occured.', error);\n\t\t\t}\n\t\t\t/* eslint-enable no-console */\n\t\t});\n\t}\n});"]}