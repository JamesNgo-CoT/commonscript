{"version":3,"sources":["backbone/form_view.min.js"],"names":["FormView","Backbone","View","extend","className","rootPath","template","_","template_buttons","render","_this","this","options","arguments","length","undefined","$el","html","model","formDefinition","$","definition","id","cid","result","success","event","preventDefault","Promise","resolve","then","beforeSave","call","save","afterSave","alert","catch","error","window","console","useBinding","choicesPromises","sectionsIndex","sectionsLength","sections","section","rowsIndex","rowsLength","rows","row","_loop","fieldsIndex","fieldsLength","field","fields","choices","choicesPromise","url","getJSON","data","Array","isArray","push","all","form","ExtendedCotForm","setModel","target","view","append","$linkButton","not","attr","on","which","click"],"mappings":"AAAA,aAKA,IAAIA,SAAWC,SAASC,KAAKC,OAAO,CAInCC,UAAW,WAEXC,SAAU,wBAEVC,SAAUC,EAAED,SAAS,6CAErBE,iBAAkBD,EAAED,SAAS,uMAI7BG,OAAQ,WACP,IAAIC,EAAQC,KAERC,EAA6B,EAAnBC,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAElFF,KAAKK,IAAIC,KAAKN,KAAKL,SAAS,CAC3BY,MAAOP,KAAKO,SAsCb,IAnCA,IAAIC,EAAiBC,EAAEjB,OAAO,GAAIQ,KAAKU,WAAY,CAClDC,GAAIX,KAAKU,WAAe,IAAK,QAAUV,KAAKO,MAAMK,IAElDlB,SAAUE,EAAEiB,OAAOb,KAAM,YAEzBc,QAASd,KAAKU,WAAoB,SAAKT,EAAQa,SAAW,SAAUC,GAuBnE,OAtBAA,EAAMC,iBAENC,QAAQC,UAAUC,KAAK,WAEtB,GAA0B,MAAtBlB,EAAQmB,WACX,OAAOnB,EAAQmB,WAAWC,KAAKtB,KAE9BoB,KAAK,WACP,OAAOpB,EAAMQ,MAAMe,SACjBH,KAAK,WAEkB,MAArBlB,EAAQsB,UACXtB,EAAQsB,UAAUF,KAAKtB,GAEvByB,MAAM,YAELC,MAAM,SAAUC,GACdA,GAASC,OAAOC,SAAWA,QAAQF,OACtCE,QAAQF,MAAM,qBAAsBA,MAI/B,GAGRG,YAAY,IAGTC,EAAkB,GACbC,EAAgB,EAAGC,EAAiBxB,EAAeyB,SAAS9B,OAAQ4B,EAAgBC,EAAgBD,IAG5G,IAFA,IAAIG,EAAU1B,EAAeyB,SAASF,GAE7BI,EAAY,EAAGC,EAAaF,EAAQG,KAAKlC,OAAQgC,EAAYC,EAAYD,IA0BjF,IAzBA,IAAIG,EAAMJ,EAAQG,KAAKF,GAEnBI,EAAQ,SAAeC,EAAaC,GACvC,IAAIC,EAAQJ,EAAIK,OAAOH,GAEvB,GAAIE,EAAME,SACoB,iBAAlBF,EAAME,QAAsB,CACtC,IAAIC,EAAiB,IAAI5B,QAAQ,SAAUC,GAC1C,IAAI4B,EAAMJ,EAAME,QAChBF,EAAME,QAAU,GAEhBnC,EAAEsC,QAAQD,GAAK3B,KAAK,SAAU6B,GACzBC,MAAMC,QAAQF,KACjBN,EAAME,QAAUI,GAEjB9B,KACE,WACFA,QAGFY,EAAgBqB,KAAKN,KAKfL,EAAc,EAAGC,EAAeH,EAAIK,OAAOxC,OAAQqC,EAAcC,EAAcD,IACvFD,EAAMC,GAKT,OAAOvB,QAAQmC,IAAItB,GAAiBX,KAAK,WACxC,IAAIkC,EAAO,IAAIC,gBAAgB9C,GAG/B,OAFA6C,EAAKE,SAASxD,EAAMQ,OAEb8C,EAAKvD,OAAO,CAClB0D,OAAQ/C,EAAE,eAAgBV,EAAMM,KAChCoD,KAAM1D,IACJoB,KAAK,WACKV,EAAE,oBAAqBV,EAAMM,KACnCqD,OAAO3D,EAAMF,iBAAiB,CAAEU,MAAOR,EAAMQ,SAEnD,IAAIoD,EAAclD,EAAE,QAASV,EAAMM,KAAKuD,IAAI,mBAC5CD,EAAYE,KAAK,OAAQ,UACzBF,EAAYG,GAAG,UAAW,SAAU/C,GACf,KAAhBA,EAAMgD,QACThD,EAAMC,iBACND,EAAMyC,OAAOQ,eAIdvC,MAAM,SAAUC,GACdA,GAASC,OAAOC,SAAWA,QAAQF,OACtCE,QAAQF,MAAM,oBAAqBA","file":"form_view.min.js","sourcesContent":["'use strict';\n\n/* global ExtendedCotForm */\n\n/* exported FormView */\nvar FormView = Backbone.View.extend({\n\n\t// MARK: PROPERTY DEFINITION\n\n\tclassName: 'FormView',\n\n\trootPath: '/* @echo SRC_PATH *//',\n\n\ttemplate: _.template('\\n    <div class=\"formWrapper\"></div>\\n  '),\n\n\ttemplate_buttons: _.template('\\n    <div class=\"hidden-print btns-bar row\">\\n      <div class=\"col-xs-12\">\\n        <button type=\"submit\" class=\"btn btn-primary btn-lg btn-submit\">Submit</button>\\n      </div>\\n    </div>\\n  '),\n\n\t// MARK: METHOD DEFINITION\n\n\trender: function render() {\n\t\tvar _this = this;\n\n\t\tvar options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n\t\tthis.$el.html(this.template({\n\t\t\tmodel: this.model\n\t\t}));\n\n\t\tvar formDefinition = $.extend({}, this.definition, {\n\t\t\tid: this.definition['id'] || 'form_' + this.model.cid,\n\n\t\t\trootPath: _.result(this, 'rootPath'),\n\n\t\t\tsuccess: this.definition['success'] || options.success || function (event) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tPromise.resolve().then(function () {\n\t\t\t\t\t// TODO - DECIDE IF CALLBACK OR EVENT\n\t\t\t\t\tif (options.beforeSave != null) {\n\t\t\t\t\t\treturn options.beforeSave.call(_this);\n\t\t\t\t\t}\n\t\t\t\t}).then(function () {\n\t\t\t\t\treturn _this.model.save();\n\t\t\t\t}).then(function () {\n\t\t\t\t\t// TODO - DECIDE IF CALLBACK OR EVENT\n\t\t\t\t\tif (options.afterSave != null) {\n\t\t\t\t\t\toptions.afterSave.call(_this);\n\t\t\t\t\t} else {\n\t\t\t\t\t\talert('Saved!');\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (error) {\n\t\t\t\t\tif (error && window.console && console.error) {\n\t\t\t\t\t\tconsole.error('An error occurred.', error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t},\n\n\t\t\tuseBinding: true\n\t\t});\n\n\t\tvar choicesPromises = [];\n\t\tfor (var sectionsIndex = 0, sectionsLength = formDefinition.sections.length; sectionsIndex < sectionsLength; sectionsIndex++) {\n\t\t\tvar section = formDefinition.sections[sectionsIndex];\n\n\t\t\tfor (var rowsIndex = 0, rowsLength = section.rows.length; rowsIndex < rowsLength; rowsIndex++) {\n\t\t\t\tvar row = section.rows[rowsIndex];\n\n\t\t\t\tvar _loop = function _loop(fieldsIndex, fieldsLength) {\n\t\t\t\t\tvar field = row.fields[fieldsIndex];\n\n\t\t\t\t\tif (field.choices) {\n\t\t\t\t\t\tif (typeof field.choices === 'string') {\n\t\t\t\t\t\t\tvar choicesPromise = new Promise(function (resolve) {\n\t\t\t\t\t\t\t\tvar url = field.choices;\n\t\t\t\t\t\t\t\tfield.choices = [];\n\n\t\t\t\t\t\t\t\t$.getJSON(url).then(function (data) {\n\t\t\t\t\t\t\t\t\tif (Array.isArray(data)) {\n\t\t\t\t\t\t\t\t\t\tfield.choices = data;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tchoicesPromises.push(choicesPromise);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfor (var fieldsIndex = 0, fieldsLength = row.fields.length; fieldsIndex < fieldsLength; fieldsIndex++) {\n\t\t\t\t\t_loop(fieldsIndex, fieldsLength);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(choicesPromises).then(function () {\n\t\t\tvar form = new ExtendedCotForm(formDefinition);\n\t\t\tform.setModel(_this.model);\n\n\t\t\treturn form.render({\n\t\t\t\ttarget: $('.formWrapper', _this.$el),\n\t\t\t\tview: _this\n\t\t\t}).then(function () {\n\t\t\t\tvar $form = $('.formWrapper form', _this.$el);\n\t\t\t\t$form.append(_this.template_buttons({ model: _this.model }));\n\n\t\t\t\tvar $linkButton = $('a.btn', _this.$el).not('[role=\"button\"]');\n\t\t\t\t$linkButton.attr('role', 'button');\n\t\t\t\t$linkButton.on('keydown', function (event) {\n\t\t\t\t\tif (event.which === 32) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.target.click();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}).catch(function (error) {\n\t\t\tif (error && window.console && console.error) {\n\t\t\t\tconsole.error('An error occured.', error);\n\t\t\t}\n\t\t});\n\t}\n});"]}