"use strict";var DataTableView=Backbone.View.extend({className:"DataTableView",configuration:{columns:function(){return[DataTableView.columns.id]}},dataTable:null,template:_.template("\n    <div class=\"row\">\n      <div class=\"col-xs-12\">\n        <table width=\"100%\" class=\"table table-bordered\">\n          <thead>\n            <tr>\n            <% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n              <th><%- _.result(configuration.columns[index], 'title') || _.result(configuration.columns[index], 'data', '') %></th>\n            <% } %>\n            </tr>\n          </thead>\n          <tbody></tbody>\n          <tfoot>\n            <tr>\n            <% for (var index = 0, length = configuration.columns.length; index < length; index++) { %>\n              <td data-index=\"<%- index %>\"><%= _.result($.extend({ view: view }, configuration.columns[index]), 'footerHtml', '') %></td>\n            <% } %>\n            </tr>\n          </tfoot>\n        </table>\n      </div>\n    </div>\n  "),reload:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.dataTable&&this.dataTable.ajax.reload(e,t)},remove:function(){this.removeDataTable(),Backbone.View.prototype.remove.call(this)},removeDataTable:function(){this.dataTable&&this.dataTable.destroy()},render:function(){var l=this,o=_.result(this,"configuration"),i=o.columns=_.result(o,"columns");return Promise.resolve(this.removeDataTable()).then(function(){for(var e=[],t=0,n=i.length;t<n;t++){var a=i[t];a.preRender&&e.push(a.preRender(a,o,l))}return Promise.all(e)}).then(function(){l.$el.html(l.template({configuration:o,view:l}))}).then(function(){var e=$.extend({},o);!0===o.serverSide?$.extend(e,{ajax:function(t,e){var n={$count:!0},a=t.columns.filter(function(e){return e.searchable&&e.search&&e.search.value}).map(function(e){return e.search.value}).join(" and ");a&&(n.$filter=a);var o=t.order.map(function(e){return t.columns[e.column].data+" "+e.dir}).join(",");o&&(n.$orderby=o),t.search&&t.search.value&&(n.$search='"'+t.search.value+'"'),n.$skip=t.start,n.$top=t.length;var r=function(){e({data:l.collection.toJSON({transform:!1}),draw:t.draw,recordsTotal:l.collection.totalRecords||0,recordsFiltered:l.collection.totalRecords||0})};l.collection.fetch({fetchParameters:n}).then(r,r)}}):$.extend(e,{data:l.collection.toJSON({transform:!1})}),l.dataTable=l.$el.find("table").DataTable(e)}).then(function(){for(var e=[],t=0,n=i.length;t<n;t++){var a=i[t];if(a.postRender&&e.push(a.postRender(a,l.configuration,l)),null!=a.events){null==l.events&&(l.events={});var o=_.result($.extend({view:l},a),"events");for(var r in o)l.events[r]=o[r]}}return l.delegateEvents(),Promise.all(e)})}},{buttonsConfiguration:{buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"csvHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"excelHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"pdfHtml5",exportOptions:{columns:":visible:not(.excludeFromButtons)"}},{extend:"print",exportOptions:{columns:":visible:not(.excludeFromButtons)"}}],dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'<'table-responsive'tr>>><'row'<'col-sm-5'i><'col-sm-7'p>>B"},columnFilters:{booleanEquals:function(e,t,n){var a="";t&&(e?"$EMPTY"===t?a=n.dataSrc()+" eq null":"$NOTEMPTY"===t?a=n.dataSrc()+" ne null":"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||(a=n.dataSrc()+" eq "+t.toLowerCase()):a=t),a!==n.search()&&(n.search(a),n.draw())},numberEquals:function(e,t,n){var a="";t&&(e?"$EMPTY"===t?a=n.dataSrc()+" eq null":"$NOTEMPTY"===t?a=n.dataSrc()+" ne null":isNaN(t)||(a=n.dataSrc()+" eq "+t.toLowerCase()):a=t),a!==n.search()&&(n.search(a),n.draw())},numberBetween:function(e,t,n){var a="";if(t)if(e){if("$EMPTY"===t)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===t)a=n.dataSrc()+" ne null";else if(-1!==t.toLowerCase().indexOf("to")){var o=t.toLowerCase().split("to");if(!isNaN(o[0])||!isNaN(o[0])){var r=[];isNaN(o[0])?r[0]=null:r[0]=n.dataSrc()+" ge "+o[0],isNaN(o[1])?r[1]=null:r[1]=n.dataSrc()+" le "+o[1],a=r.filter(function(e){return e}).join(" and ")}}}else a=t;a!==n.search()&&(n.search(a),n.draw())},stringEquals:function(e,t,n){var a="";t&&(a=e?"$EMPTY"===t?n.dataSrc()+" eq null":"$NOTEMPTY"===t?n.dataSrc()+" ne null":"tolower("+n.dataSrc()+") eq '"+t.toLowerCase()+"'":t),a!==n.search()&&(n.search(a),n.draw())},stringContains:function(e,t,n){var a="";if(t)if(e)if("$EMPTY"===t)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===t)a=n.dataSrc()+" ne null";else{for(var o=t.toLowerCase().split(" "),r=[],l=0,i=o.length;l<i;l++)r.push("contains(tolower("+n.dataSrc()+"),'"+o[l]+"')");a=r.join(" and ")}else a=t;a!==n.search()&&(n.search(a),n.draw())},dateEquals:function(e,t,n){var a="";if(t)if(e){if("$EMPTY"===t)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===t)a=n.dataSrc()+" ne null";else if(moment(t,"l").isValid()){var o=moment(t,"l").set({hour:0,minute:0,second:0,millisecond:0}).format(),r=moment(o).add({hours:24}).format();a=n.dataSrc()+" ge "+o+" and "+n.dataSrc()+" le "+r}}else a=t;a!==n.search()&&(n.search(a),n.draw())},dateBetween:function(e,t,n){var a="";if(t)if(e){if("$EMPTY"===t)a=n.dataSrc()+" eq null";else if("$NOTEMPTY"===t)a=n.dataSrc()+" ne null";else if(-1!==t.toLowerCase().indexOf("to")){var o=t.toLowerCase().split("to");if(moment(o[0]).isValid()||moment(o[1]).isValid()){var r=[];if(moment(o[0]).isValid()){var l=moment(o[0]).set({hour:0,minute:0,second:0,millisecond:0}).format();r[0]=n.dataSrc()+" ge "+l}else r[0]=null;if(moment(o[1]).isValid()){var i=moment(o[1]).set({hour:0,minute:0,second:0,millisecond:0}).add({hours:24}).format();r[1]=n.dataSrc()+" le "+i}else r[1]=null;a=r.filter(function(e){return e}).join(" and ")}}}else a=t;a!==n.search()&&(n.search(a),n.draw())}},columns:{id:{data:"id",title:"ID"}},preRenders:{searchFooterFactory:function(o){return"string"==typeof o&&(o=DataTableView.columnFilters[o]),function(t,n,a){return Promise.resolve().then(function(){if(t.choices&&"string"==typeof t.choices){var e=t.choices;return t.choices=[],fetchConfigurations(e,t.choices)}}).then(function(){t.choices?t.footerHtml='\n            <label class="sr-only" for="'+t.data+"_"+a.cid+'">Search '+(t.title||t.data)+'</label>\n            <select class="form-control" id="'+t.data+"_"+a.cid+'">\n              '+(null!=t.choices[0].value?""!=t.choices[0].value?'<option value=""></option>':"":""!=t.choices[0].text?'<option value=""></option>':"")+"\n              "+t.choices.map(function(e){return'<option value="'+(null!==e.value?e.value:e.text)+'">'+e.text+"</option>"}).join("")+"\n            </select>\n          ":t.footerHtml='\n            <label class="sr-only" for="'+t.data+"_"+a.cid+'">Search '+(t.title||t.data)+'</label>\n            <input type="text" class="form-control" id="'+t.data+"_"+a.cid+'">\n          ',t.events||(t.events={}),t.events["change #"+t.data+"_"+a.cid]=function(e){var t=$(e.currentTarget);o(n.serverSide,t.val(),a.dataTable.column(+t.closest("td").data("index")))},t.events["keyup #"+t.data+"_"+a.cid]=function(e){var t=$(e.currentTarget);o(n.serverSide,t.val(),a.dataTable.column(+t.closest("td").data("index")))}})}}}});
//# sourceMappingURL=datatable_view.min.js.map
